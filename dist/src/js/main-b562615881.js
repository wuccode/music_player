!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t=t||self).infSign=n()}(this,function(){"use strict";function n(n,t){var r,e=Object.keys(n);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(n),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})),e.push.apply(e,r)),e}function d(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(o,!0).forEach(function(t){var n,r;n=e,r=o[t=t],t in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function t(t,n){return t(n={exports:{}},n.exports),n.exports}function r(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function e(t){return null!=t&&(r(t)||"function"==typeof(n=t).readFloatLE&&"function"==typeof n.slice&&r(n.slice(0,0))||!!t._isBuffer);var n}var i=t(function(t,n){var i;t.exports={isIOS:(i={str2Json:function(t){var n={};if("[object String]"===Object.prototype.toString.call(t))try{n=JSON.parse(t)}catch(t){n={}}return n},json2Str:function(t){var n=t;if("string"!=typeof t)try{n=JSON.stringify(t)}catch(t){n=""}return n},_extend:function(t,n){if(n)for(var r in t)n.hasOwnProperty(r)||(n[r]=t[r]);return n},formatURL:{browser:"",url:""},formatSong:{filename:"",filesize:"",hash:"",bitrate:"",extname:"",duration:"",mvhash:"",m4afilesize:"","320hash":"","320filesize":"",sqhash:"",sqfilesize:0,feetype:0,isfirst:0},formatMV:{filename:"",singername:"",hash:"",imgurl:""},formatShare:{shareName:"",topicName:"",hash:"",listID:"",type:"",suid:"",slid:"",imgUrl:"",filename:"",duration:"",shareData:{linkUrl:"",picUrl:"",content:"",title:""}},cbNum:0,isIOS:!!navigator.userAgent.match(/KGBrowser/gi),isKugouAndroid:!!navigator.userAgent.match(/kugouandroid/gi),isAndroid:"undefined"!=typeof external&&void 0!==external.superCall,loadUrl:function(t){var n=document.createElement("iframe");n.setAttribute("src",t),n.setAttribute("style","display:none;"),n.setAttribute("height","0px"),n.setAttribute("width","0px"),n.setAttribute("frameborder","0"),document.body.appendChild(n),n.parentNode.removeChild(n)},callCmd:function(r){var e=i;if(e.isKugouAndroid){var t={},n="",n=(r.cmd&&(t.cmd=r.cmd),r.jsonStr&&(t.jsonStr=r.jsonStr),r.callback&&(n="kgandroidmobilecall"+ ++e.cbNum+Math.random().toString().substr(2,9),t.callback=n,window[n]=function(t,n){void 0!==t&&("[object String]"===Object.prototype.toString.call(t)?(t="#"===n?decodeURIComponent(t):decodeURIComponent(decodeURIComponent(t)),r.callback(e.str2Json(t))):r.callback(t))}),r.AndroidCallback&&((o=e.str2Json(r.jsonStr)).AndroidCallback=n,r.jsonStr=e.json2Str(o),r.jsonStr)&&(t.jsonStr=r.jsonStr),encodeURIComponent(JSON.stringify(t))),o="kugoujsbridge://start.kugou_jsbridge/?".concat(n);e.loadUrl(o)}else if(e.isAndroid){t="";if(r.jsonStr){r.callback&&""!==r.callback&&!0===r.AndroidCallback&&(n="kgmobilecall"+ ++e.cbNum+Math.random().toString().substr(2,9),window[n]=function(t,n){void 0!==t&&("[object String]"===Object.prototype.toString.call(t)?(t="#"===n?decodeURIComponent(t):decodeURIComponent(decodeURIComponent(t)),r.callback(e.str2Json(t))):r.callback(t))},(o=e.str2Json(r.jsonStr)).AndroidCallback=n,r.jsonStr=e.json2Str(o));try{t=external.superCall(r.cmd,r.jsonStr)}catch(t){}}else try{t=external.superCall(r.cmd)}catch(t){}r.callback&&""!==r.callback&&"AndroidCallback"!=t&&(t=e.str2Json(t),r.callback(t))}else{n="",o="";r.callback&&(o="kgmobilecall"+ ++e.cbNum+Math.random().toString().substr(2,9),window[o]=function(t){void 0!==t&&r.callback&&("[object String]"===Object.prototype.toString.call(t)?r.callback(e.str2Json(t)):r.callback(t))}),o&&""!=o&&r.jsonStr&&(n='kugouurl://start.music/?{"cmd":'+r.cmd+', "jsonStr":'+r.jsonStr+', "callback":"'+o+'"}'),o&&""!=o&&!r.jsonStr&&(n='kugouurl://start.music/?{"cmd":'+r.cmd+', "callback":"'+o+'"}'),""==o&&r.jsonStr&&(n='kugouurl://start.music/?{"cmd":'+r.cmd+', "jsonStr":'+r.jsonStr+"}"),""!=o||r.jsonStr||(n='kugouurl://start.music/?{"cmd":'+r.cmd+"}"),e.loadUrl(n)}},formartData:function(t,n){t&&123==t&&(n=n&&i._extend(i.formatURL,n)),t&&123==t&&n&&i._extend(i.formatURL,n)}}).isIOS,isKugouAndroid:i.isKugouAndroid,isAndroid:i.isAndroid,isInClient:function(){return!(!i.isAndroid&&!i.isKugouAndroid&&!i.isIOS)},mobileCall:function(t,n,r){var e="";if(n&&(e=i.json2Str(n)),!t)return console.error("请输入命令号！"),!1;n={};t&&(n.cmd=t),""!=e&&(n.jsonStr=e),r&&(n.callback=r),t&&186==t&&r&&(n.AndroidCallback=!0),i.callCmd(n)},KgWebMobileCall:function(e,o){if(e)try{var i=e.split(".");i.reduce(function(t,n){var r;return t[n]?n===i[i.length-1]?"function"==typeof(r=t[n])?(t[n]=function(t){r&&r(t),o&&o(t)},t[n]):(console.error("请检查，当前环境变量已注册了对象："+e+"，且该对象不是方法"),null):t[n]:(n===i[i.length-1]?t[n]=function(t){o&&o(t)}:t[n]=new Object,t[n])},window)}catch(e){}}}}),o=t(function(t){var i,r;i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(t,n){return t<<n|t>>>32-n},rotr:function(t,n){return t<<32-n|t>>>n},endian:function(t){if(t.constructor==Number)return 16711935&r.rotl(t,8)|4278255360&r.rotl(t,24);for(var n=0;n<t.length;n++)t[n]=r.endian(t[n]);return t},randomBytes:function(t){for(var n=[];0<t;t--)n.push(Math.floor(256*Math.random()));return n},bytesToWords:function(t){for(var n=[],r=0,e=0;r<t.length;r++,e+=8)n[e>>>5]|=t[r]<<24-e%32;return n},wordsToBytes:function(t){for(var n=[],r=0;r<32*t.length;r+=8)n.push(t[r>>>5]>>>24-r%32&255);return n},bytesToHex:function(t){for(var n=[],r=0;r<t.length;r++)n.push((t[r]>>>4).toString(16)),n.push((15&t[r]).toString(16));return n.join("")},hexToBytes:function(t){for(var n=[],r=0;r<t.length;r+=2)n.push(parseInt(t.substr(r,2),16));return n},bytesToBase64:function(t){for(var n=[],r=0;r<t.length;r+=3)for(var e=t[r]<<16|t[r+1]<<8|t[r+2],o=0;o<4;o++)8*r+6*o<=8*t.length?n.push(i.charAt(e>>>6*(3-o)&63)):n.push("=");return n.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/gi,"");for(var n=[],r=0,e=0;r<t.length;e=++r%4)0!=e&&n.push((i.indexOf(t.charAt(r-1))&Math.pow(2,-2*e+8)-1)<<2*e|i.indexOf(t.charAt(r))>>>6-2*e);return n}},t.exports=r}),c={utf8:{stringToBytes:function(t){return c.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(c.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var n=[],r=0;r<t.length;r++)n.push(255&t.charCodeAt(r));return n},bytesToString:function(t){for(var n=[],r=0;r<t.length;r++)n.push(String.fromCharCode(t[r]));return n.join("")}}},s=c,g=t(function(t){function h(t,n){t.constructor==String?t=(n&&"binary"===n.encoding?S:y).stringToBytes(t):j(t)?t=Array.prototype.slice.call(t,0):Array.isArray(t)||(t=t.toString());for(var r=m.bytesToWords(t),n=8*t.length,e=1732584193,o=-271733879,i=-1732584194,c=271733878,s=0;s<r.length;s++)r[s]=16711935&(r[s]<<8|r[s]>>>24)|4278255360&(r[s]<<24|r[s]>>>8);r[n>>>5]|=128<<n%32,r[14+(64+n>>>9<<4)]=n;for(var a=h._ff,l=h._gg,u=h._hh,f=h._ii,s=0;s<r.length;s+=16){var d=e,g=o,b=i,p=c,o=f(o=f(o=f(o=f(o=u(o=u(o=u(o=u(o=l(o=l(o=l(o=l(o=a(o=a(o=a(o=a(o,i=a(i,c=a(c,e=a(e,o,i,c,r[s+0],7,-680876936),o,i,r[s+1],12,-389564586),e,o,r[s+2],17,606105819),c,e,r[s+3],22,-1044525330),i=a(i,c=a(c,e=a(e,o,i,c,r[s+4],7,-176418897),o,i,r[s+5],12,1200080426),e,o,r[s+6],17,-1473231341),c,e,r[s+7],22,-45705983),i=a(i,c=a(c,e=a(e,o,i,c,r[s+8],7,1770035416),o,i,r[s+9],12,-1958414417),e,o,r[s+10],17,-42063),c,e,r[s+11],22,-1990404162),i=a(i,c=a(c,e=a(e,o,i,c,r[s+12],7,1804603682),o,i,r[s+13],12,-40341101),e,o,r[s+14],17,-1502002290),c,e,r[s+15],22,1236535329),i=l(i,c=l(c,e=l(e,o,i,c,r[s+1],5,-165796510),o,i,r[s+6],9,-1069501632),e,o,r[s+11],14,643717713),c,e,r[s+0],20,-373897302),i=l(i,c=l(c,e=l(e,o,i,c,r[s+5],5,-701558691),o,i,r[s+10],9,38016083),e,o,r[s+15],14,-660478335),c,e,r[s+4],20,-405537848),i=l(i,c=l(c,e=l(e,o,i,c,r[s+9],5,568446438),o,i,r[s+14],9,-1019803690),e,o,r[s+3],14,-187363961),c,e,r[s+8],20,1163531501),i=l(i,c=l(c,e=l(e,o,i,c,r[s+13],5,-1444681467),o,i,r[s+2],9,-51403784),e,o,r[s+7],14,1735328473),c,e,r[s+12],20,-1926607734),i=u(i,c=u(c,e=u(e,o,i,c,r[s+5],4,-378558),o,i,r[s+8],11,-2022574463),e,o,r[s+11],16,1839030562),c,e,r[s+14],23,-35309556),i=u(i,c=u(c,e=u(e,o,i,c,r[s+1],4,-1530992060),o,i,r[s+4],11,1272893353),e,o,r[s+7],16,-155497632),c,e,r[s+10],23,-1094730640),i=u(i,c=u(c,e=u(e,o,i,c,r[s+13],4,681279174),o,i,r[s+0],11,-358537222),e,o,r[s+3],16,-722521979),c,e,r[s+6],23,76029189),i=u(i,c=u(c,e=u(e,o,i,c,r[s+9],4,-640364487),o,i,r[s+12],11,-421815835),e,o,r[s+15],16,530742520),c,e,r[s+2],23,-995338651),i=f(i,c=f(c,e=f(e,o,i,c,r[s+0],6,-198630844),o,i,r[s+7],10,1126891415),e,o,r[s+14],15,-1416354905),c,e,r[s+5],21,-57434055),i=f(i,c=f(c,e=f(e,o,i,c,r[s+12],6,1700485571),o,i,r[s+3],10,-1894986606),e,o,r[s+10],15,-1051523),c,e,r[s+1],21,-2054922799),i=f(i,c=f(c,e=f(e,o,i,c,r[s+8],6,1873313359),o,i,r[s+15],10,-30611744),e,o,r[s+6],15,-1560198380),c,e,r[s+13],21,1309151649),i=f(i,c=f(c,e=f(e,o,i,c,r[s+4],6,-145523070),o,i,r[s+11],10,-1120210379),e,o,r[s+2],15,718787259),c,e,r[s+9],21,-343485551),e=e+d>>>0;o=o+g>>>0,i=i+b>>>0,c=c+p>>>0}return m.endian([e,o,i,c])}var m,y,j,S;m=o,y=s.utf8,j=e,S=s.bin,h._ff=function(t,n,r,e,o,i,c){t=t+(n&r|~n&e)+(o>>>0)+c;return(t<<i|t>>>32-i)+n},h._gg=function(t,n,r,e,o,i,c){t=t+(n&e|r&~e)+(o>>>0)+c;return(t<<i|t>>>32-i)+n},h._hh=function(t,n,r,e,o,i,c){t=t+(n^r^e)+(o>>>0)+c;return(t<<i|t>>>32-i)+n},h._ii=function(t,n,r,e,o,i,c){t=t+(r^(n|~e))+(o>>>0)+c;return(t<<i|t>>>32-i)+n},h._blocksize=16,h._digestsize=16,t.exports=function(t,n){if(null==t)throw new Error("Illegal argument "+t);t=m.wordsToBytes(h(t,n));return n&&n.asBytes?t:n&&n.asString?S.bytesToString(t):m.bytesToHex(t)}});return function(){function n(){var t=(new Date).getTime(),n=[],r=[],e="NVPh5oo715z5DIWAeQlhMDsWXXQV4hwt",t={srcappid:"2919",clientver:"20000",clienttime:t,mid:t,uuid:t,dfid:"-"};for(o in l&&(delete t.clienttime,delete t.mid,delete t.uuid,delete t.dfid),f=d({},t,{},f))n.push(o);if(n.sort(),n.forEach(function(t){r.push(t+"="+f[t])}),s)if("[object Object]"==Object.prototype.toString.call(s))if("json"==u)r.push(JSON.stringify(s));else{var o,i=[];for(o in s)i.push(o+"="+s[o]);r.push(i.join("&"))}else r.push(s);r.unshift(e),r.push(e),f.signature=g(r.join("")),a.log&&(console.log("H5签名前参数",r),console.log("H5签名后返回",f)),s?c&&c(f,"[object Object]"==Object.prototype.toString.call(s)&&"json"==u?JSON.stringify(s):s):c&&c(f)}var c,r,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},e=!1,l=!1,u="json",f=d({},t),o=i.isInClient();"function"==typeof a?c=a:(c=a.callback,e=a.useH5||!1,u=a.postType||"json",l=a.isCDN||!1),(o=!s||"[object Object]"==Object.prototype.toString.call(s)&&"urlencoded"!=u?o:!1)&&!e?(r=!1,i.mobileCall(764,{get:f,post:s},function(t){return!r&&(r=!0,t&&t.status?(delete t.status,a.log&&(console.log("客户端签名前参数",{get:f,post:s}),console.log("客户端签名后返回",d({},f,{},t))),f=d({},f,{},t),s?c&&c(f,"[object Object]"==Object.prototype.toString.call(s)&&"json"==u?JSON.stringify(s):s):c&&c(f),!1):(o=!1,void n()))})):(o=!1,n())}});
let $=(()=>{let n=new Map;return function(t){var e;return n.has(t)?n.get(t):(e="string"==typeof t?document.querySelector(t):null,n.set(t,e),e)}})();function getStyleAttr(t,e){return(t.currentStyle||window.getComputedStyle(t,null))[e]}function debounce(e,n=300){let r=null;return function(...t){r&&clearTimeout(r),r=setTimeout(()=>{e.apply(this,t)},n)}}function time(t){return t?(parseInt(t/60)<10?parseInt(t/60).toString().padStart(2,0):parseInt(t/60))+":"+(t%60<10?(t%60).toString().padStart(2,0):t%60):"00:00"}
class ProgressBar{constructor({box:i,bar:t,circle:o,direction:s}){this.box=i,this.bar=t,this.direction=s,this.circle=o,this.flag=!0,this.off="x"==this.direction?"left":"top",this.off1="x"==this.direction?"offsetLeft":"offsetTop",this.off2="x"==this.direction?"clientWidth":"clientHeight",this.off3="x"==this.direction?"width":"height",this.off4="x"==this.direction?"clientX":"clientY",this.circle.onmousedown=this.mousedown.bind(this),this.box.addEventListener("click",this.boxClick.bind(this))}boxClick(i){let t=i[this.off4]-this.box.getBoundingClientRect()[this.off];(t=t<0?0:t)>this.box[this.off2]&&(t=this.box[this.off2]),play.progress(this.direction,t),this.amend(i[this.off4]-this.box.getBoundingClientRect()[this.off])}mousedown(i){let t=i[this.off4],o=this.circle[this.off1];this.flag=!1,document.onmousemove=i=>{this.amend(o+(i[this.off4]-t))},document.onmouseup=i=>{document.onmousemove=null,document.onmouseup=null,this.boxClick(i),this.flag=!0}}amend(i){(i=i<0?0:i)>this.box[this.off2]&&(i=this.box[this.off2]),this.circle.style[this.off]=i+"px",this.bar.style[this.off3]=("top"==this.off?100-i:i)+"px"}}let auidoProgress=new ProgressBar({box:$(".progress"),bar:$(".progress-w"),circle:document.querySelector(".progress-x"),direction:"x"}),volumeProgress=new ProgressBar({box:$(".sY"),bar:$(".sY-H"),circle:$(".sY-Y"),direction:"y"});
var dataJson=[];
class Server{static host="";constructor(){this.op={dfid:"11S2N83vTvaU1NxBqR3ux4LI",mid:"3e816bafb8e505de2310a0329b00f5b6",token:"",userid:"0",uuid:"3e816bafb8e505de2310a0329b00f5b6"}}jsonp(t,s){return new Promise(n=>{var e=document.createElement("script");e.src=t,document.body.appendChild(e),document.body.removeChild(e);try{window[s]=function(e){n(e)}}catch(e){}})}getSearchList(t){return new Promise(n=>{window.infSign(Object.assign(t,this.op),null,{useH5:!0,postType:"json",callback:async e=>{e="https://complexsearch.kugou.com/v2/search/song?"+Server.join(e),e=await this.jsonp(e,t.callback);n(e)}})})}getAudio(e){return new Promise(n=>{window.infSign(Object.assign(e,this.op),null,{useH5:!0,postType:"json",callback:async e=>{e=await fetch(Server.host+("/api/audioUrl?"+Server.join(e))).then(e=>e.json()).then(e=>e);n(e)}})})}getAudioUrl(n){return new Promise(async e=>{e(await fetch(Server.host+(`/api/fileDownload?hash=${n.hash}&url=`+n.url)).then(e=>e.json()).then(e=>e))})}static join(s){return Object.keys(s).reduce((e,n,t)=>e+((t?"&":"")+n+"="+s[n]),"")}}const serve=new Server;
const music=document.getElementsByTagName("audio")[0];class Play{constructor(){this.musicTime=[],this.musicSite=0,this.status=0,this.isError=!0,this.posArr=["-64px -179px","0 -179px","-128px -179px"],$(".pause").addEventListener("click",this.play),$(".play").addEventListener("click",this.pause),$(".next").addEventListener("click",this.next.bind(this)),$(".prev").addEventListener("click",this.prev.bind(this)),$("#music").addEventListener("timeupdate",this.audioUpdate.bind(this)),$("#music").addEventListener("ended",this.audioEnded.bind(this)),$("#music").addEventListener("error",this.audioError.bind(this)),$(".icon").addEventListener("click",this.iconClick.bind(this))}play(t){t||audioInfo.getCurrentMusic(),$("#music").play(),audioCtx.resume(),$(".pause").style.display="none",$(".play-bar").className="play-bar play-active",$(".content-left").className="content-left",$(".play").style.display="inline-block"}pause(){music.pause(),this.style.display="none",$(".pause").style.display="inline-block",$(".play-bar").className="play-bar",$(".content-left").className="content-left left-active"}next(){audioInfo.getNextMusic(),this.play()}prev(){audioInfo.getPrevMusic(),this.play()}progress(t,i){if("x"==t)try{$("#music").currentTime=music.duration*(i/400)}catch(t){}else music.volume=1-i/100}iconClick(){this.status++,this.status>this.posArr.length-1&&(this.status=0),$(".icon").style.backgroundPosition=this.posArr[this.status]}audioEnded(){0==this.status?this.next():1==this.status?($("#music").play(),audioCtx.resume()):2==this.status&&$("#ul-list").children[parseInt(Math.random()*audioInfo.arrMusicJson.length)].click()}audioError(){this.isError||this.next()}audioUpdate(){let e=music.currentTime;var t;this.musicSite=this.musicTime.findIndex((t,i)=>t<e&&e<this.musicTime[i+1]),-1!=this.musicSite&&(t=$(".main").clientHeight/2,$(".main-content").style.top=-(40*this.musicSite-t+40)+"px",[...$(".main-content").children].map(t=>t.removeAttribute("class","action")),$(".main-content").children[this.musicSite])&&$(".main-content").children[this.musicSite].setAttribute("class","action"),$("#content-time").innerText=time(parseInt(music.currentTime))+" / "+time(parseInt($("#music").duration)),auidoProgress.flag&&auidoProgress.amend(Math.ceil(e/music.duration*400))}async change(t){let n=(await serve.getAudioUrl(t))["url"];audioInfo.setLoading=!1,this.musicTime=[],$("#music").src=Server.host+n,$("#music").oncanplay=()=>{$("#left-content").innerHTML=t.album_name,$("#left-content").title=t.album_name,$("#right-content").innerHTML=t.author_name,$("#right-content").title=t.author_name,$("#content-title").innerHTML=t.song_name,$(".musicName").innerText=t.song_name,$("#content-title").title=t.song_name,$("#img-bg").style.background=`url(${t.img}) no-repeat`,$("#left-img").src=t.img,$("#mu-bg").src=t.img,$(".load").href=Server.host+n,$(".load").download=t.audio_name,$(".main-content").innerHTML="",this.isError||this.play(1),this.isError=!1,audioCtx.resume(),t.freePart?($(".freePart").style.left=$(".progress").clientWidth*(60/$("#music").duration)+"px",$(".freePart").style.display="block"):$(".freePart").style.display="none";var i=t.lyrics.split("[");for(let t=0;t<i.length;t++){var e=i[t].split("]"),s=e[0].split(":"),s=Math.round(60*s[0]+ +s[1]);isNaN(s)||($(".main-content").innerHTML+=`<p>${e[1]}</p>`,this.musicTime.push(s))}}}}const play=new Play;
class AudioInfo{constructor(){var s=localStorage.getItem("music");this.loading=!1,this.arrMusicJson="[]"!=s&&s?JSON.parse(s):dataJson,this.currentHash="",this.currentIndex=0,this.nextMusic={},this.prevMusic={},this.initSongList(),this.setCurrentHash=this.arrMusicJson[0].hash,$("#int").addEventListener("keyup",debounce(this.intKeyUp.bind(this))),$("#esc").addEventListener("click",()=>$("#esc").parentNode.style.display="none"),$("#bs").addEventListener("click",()=>this.getSearch($("#int").value)),$("#int").addEventListener("keydown",s=>13==s.keyCode&&this.getSearch($("#int").value)),$(".mlist").addEventListener("click",this.mlistClick)}set setLoading(s){var t=s?"flex":"none";$(".loading").style.display=t,this.loading=s}set setCurrentHash(t){this.setLoading=!0;var s=document.querySelectorAll(".nameList"),e=(s.forEach(s=>s.className="nameList"),this.arrMusicJson.findIndex(({hash:s})=>s==t));s[e].className="active nameList",this.currentHash=t,this.currentIndex=e,play.change(this.arrMusicJson[this.currentIndex])}get getCurrentMusic(){return this.arrMusicJson.length<=0?(alert("请搜索歌曲"),()=>!1):(this.currentHash!=this.arrMusicJson[this.currentIndex].hash&&(this.setCurrentHash=this.arrMusicJson[this.currentIndex].hash),()=>this.arrMusicJson[this.currentIndex])}get getNextMusic(){var s;return this.arrMusicJson.length<=0?(alert("请搜索歌曲"),()=>!1):(s=this.currentIndex+1>this.arrMusicJson.length-1?0:this.currentIndex+1,this.nextMusic=this.arrMusicJson[s],this.setCurrentHash=this.arrMusicJson[s].hash,()=>this.nextMusic)}get getPrevMusic(){var s;return this.arrMusicJson.length<=0?(alert("请搜索歌曲"),()=>!1):(s=this.currentIndex-1<0?this.arrMusicJson.length-1:this.currentIndex-1,this.prevMusic=this.arrMusicJson[s],this.setCurrentHash=this.arrMusicJson[s].hash,()=>this.prevMusic)}async intKeyUp(s){if(13!==s.keyCode){let t=this;s=`https://searchtip.kugou.com/getSearchTip?keyword=${s.target.value}&callback=callback1&_=`+Date.now(),s=await serve.jsonp(s,"callback1");($("#list").innerHTML="")==s||0==s.data.length?$("#list").style.display="none":($("#list").style.display="block",0<s.data.length&&s.data[0].RecordDatas.forEach(s=>{$("#list").innerHTML+='<li><span id="co">'+s.HintInfo+"</span><span> 热度:"+s.Hot+"</span></li>";for(let s=0;s<$("#list").children.length;s++)$("#list").children[s].onclick=function(){t.getSearch(this.children[0].innerText)}}))}}async getSearch(s){this.setLoading=!0;let i=await serve.getSearchList({appid:1014,bitrate:0,callback:"callback2",clientver:1e3,filter:10,inputtype:0,iscorrection:1,isfuzzy:0,keyword:s,page:1,pagesize:40,platform:"WebFilter",privilege_filter:0});this.setLoading=!1,i.data.lists.length<1||($("#listS").innerHTML="",$("#floatHeaderTitle").innerText=`“${s}”`,$(".floatList").style.display="block",i.data.lists.forEach((s,t)=>{var e=document.createElement("li");e.innerHTML=`<span class="nums">${t+1}.</span>
          <span class="mName">${s.FileName}</span>
          <img class="ds" src="./img/d.png" alt="">
          <span class="mAlbum">${s.AlbumName}</span>
          <span class="mTime">${time(s.Duration)}</span>`,$("#listS").appendChild(e),e.addEventListener("click",()=>this.getAudioInfo(i.data.lists[t]))}),$("#list").innerHTML="",$(".to").innerText="为你搜索到"+i.data.lists.length+"首歌曲更多请登录客户端...")}async getAudioInfo({EMixSongID:s}){this.setLoading=!0;let t=await serve.getAudio({appid:1014,dfid:"11S2N83vTvaU1NxBqR3ux4LI",dfid:"11S2N83vTvaU1NxBqR3ux4LI",encode_album_audio_id:s,mid:"3e816bafb8e505de2310a0329b00f5b6",platid:4,uuid:"3e816bafb8e505de2310a0329b00f5b6",token:""});t.url?(this.setLoading=!1,-1==this.arrMusicJson.findIndex(s=>s.hash==t.hash)&&this.arrMusicJson.unshift(t),localStorage.setItem("music",JSON.stringify(this.arrMusicJson)),this.initSongList(),this.setCurrentHash=t.hash):(alert("获取失败"),this.setLoading=!1)}initSongList(){$("#ul-list").innerHTML="",$(".num").innerText=this.arrMusicJson.length,0<this.arrMusicJson.length?$(".hint").style.display="none":$(".hint").style.display="block";let n=this;this.arrMusicJson.forEach((s,t)=>{var e=document.createElement("li"),i=n.arrMusicJson[t].hash==n.currentHash?"active nameList":"nameList";e.innerHTML=`<span class="id">${t+1}</span> <span class="${i}">${s.audio_name}</span> <span class="del iconfont"></span>`,$("#ul-list").appendChild(e),e.onclick=async function(s){0<n.arrMusicJson.length&&($(".hint").style.display="none"),"del iconfont"!==s.target.className&&(n.setCurrentHash=n.arrMusicJson[t].hash),"del iconfont"===s.target.className&&(n.arrMusicJson.splice(t,1),localStorage.setItem("music",JSON.stringify(n.arrMusicJson)),n.initSongList())}})}mlistClick(s){["mlist","icon","num"].includes(s.target.className)&&("block"==$(".mlist-content").style.display?$(".mlist-content").style.display="none":$(".mlist-content").style.display="block")}}const audioInfo=new AudioInfo;
const audioCtx=new(window.AudioContext||window.webkitAudioContext);let analyser=audioCtx.createAnalyser(),source=null,bufferLength=(source=audioCtx.createMediaElementSource($("#music")),analyser.connect(audioCtx.destination),analyser.fftSize=1024,analyser.frequencyBinCount),dataArray=new Uint8Array(bufferLength),gainNode=audioCtx.createGain(),canvas=(source.connect(analyser),source.connect(gainNode),gainNode.connect(audioCtx.destination),document.getElementById("canvas")),ctx=canvas.getContext("2d"),CW=canvas.width,CH=canvas.height,BW=CW/bufferLength-1,BH,grd=ctx.createLinearGradient(0,CH,0,0);function draw(){analyser.getByteFrequencyData(dataArray);let t=0;ctx.clearRect(0,0,CW,CH);for(let e=0;e<bufferLength;e++)BH=dataArray[e],ctx.fillRect(CW/2+t,CH,1.5,-BH),ctx.fillRect(CW/2-t,CH,1.5,-BH),t+=BW+1.2;"running"==audioCtx.state&&requestAnimationFrame(draw)}grd.addColorStop(0,"#f2330d"),grd.addColorStop(1,"#d48250"),ctx.fillStyle=grd,audioCtx.onstatechange=()=>{"running"==audioCtx.state&&draw()};
